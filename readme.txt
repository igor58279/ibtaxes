1. Автоматизация налоговых расчетов для Interactive Brokers .csv statements

2. Проект делается для личного использования и для первой подачи декларации в 2021г

3. Проект обрабатывает встречающиеся у меня транзакции
    3.1 Купля продажа опционов и акций
    3.2 Короткие продажи
    3.3 Дивиденды
    3.4 Брокерские проценты, другие оплаты
    3.5 Счет и все операции в долларах, для налоговых расчетов используются курсы валют с сайта центробанка
        https://www.cbr.ru/currency_base/dynamics, курсы скачиваются в xls, надо руками сохранить в .csv
    3.6 Я считаю по TradeDate , SettleDate предыдущая колонка - можно поменять
    3.7 Я не округляю и использую float(надо бы переделать на BigDecimal), в тысячных отчет разъезжается, так как IB дает точную цифру, но сам считает 
       до сотых. С моими брокерскими отчетами совпадает.
    3.8 Корпоративные акции я пока обрабатываю stock dividends и создаю файл с произошедшими событиями
         Поглощения и прочее я пока обрабатывать не умею.
    3.9 FIFO, учет курса доллара на момент сделки
4. Я не писал код лет 20 и это мой первый проект на java, так что с алгоритмом тут все нормально, но все немного грязновато, не надо мне об этом сообщать.
    Я frequent trader, руками заносить транзакции предыдущего дня оказалось лениво и вносило кучу ошибок, платные сервисы меня не привлекли,
    да и не спортивно:)
5. Я запускаю из eclipse или делаю (в нем же) jar , при запуске проект ищет конфигурационный файл и пишет откуда.
6. В конфигурационном файле(app.cfg) , если пишете по русски свои данные , то пропустите его через native2ascii, или просто замените руками в итоговых файлах
//откуда берутся данные - курсы, движение денег, подтвержденные транзакции
statements_dir=/Users/igor/Brokerage/IB/

// конвертированные в .csv курсы валют, всюду можно писать множественные файлы через ";"
exchange_files=rates_cb.csv
// подтверждения продаж (flex отчет)
statements_files=confirmation1-4.csv
движение денег  (flex отчет)
cash_files=cash_activity-2.csv;cash_activity-3.csv

//отчет IB по корпоративным действиям
corporates_files=corporateActions.csv

// начало и конец периода для которого печатать подлежащие налогообложению транзакции
// если сделки тянуться с предыдущих годов, то их надо загружать
period_start=01/01/20
period_end=31/12/20
// данные для шапок выходных файлов
account=U1234567
first_name=Name
last_name=Lastname
first_name_rus=Игорь
last_name_rus=Игорь
middle_name_rus=Игорь

7. Выходные файлы
   7.1 taxes.csv - закрытые в указанный конфигурации период транзакции опционы и акции
   7.2 divs.csv      - дивиденды в указанный конфигурации период
   7.3 open.csv      - открытые на конец периода позиции , скажем для проверки
   7.4 cash.csv      - подлежащие налоговому учету денежные транзакции - платы, проценты 
   7.5 corp_actions.csv - произошедшие корпоративные события
   
   Вероятно эти файлы надо вносить потом вместе с отчетами от брокера на сайте налоговой и руками заносить итоговые результаты.
   Я еще никогда не сдавал отчет по иностранному брокеру. 

8. Не обрабатываемые транзакции (скажем денежные переводы на счет), неправильно обработанные строки - выбрасываются на консоль.
   Если будете присылать вместе с исходными строками данных - попытаюсь посмотреть и добавить поддержку.
   
9. Файл подтвержденных транзакций формируется со следующими параметрами
   https://github.com/igor58279/ibtaxes/blob/master/trade-confirmation-parameters.png
10. Отчет по корпоративным событиям берется из секции Corporate Actions 
   https://github.com/igor58279/ibtaxes/blob/master/corporate-actions-parameters.png
11. Если есть желание посчитать/проверить и не выходит - можете заменить номер счета и прислать брокерские по почте мне.
    Я обработаю и вышлю результат, поправив баги у себя, если это не окажется мегатрудоемко.
    ig_2@mail.ru    
12.  Я потихоньку буду править/дописывать, но вроде как мои цели на этот год программа закрывает
   
   


